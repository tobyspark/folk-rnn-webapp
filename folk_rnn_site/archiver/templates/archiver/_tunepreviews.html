{% load humanize %}
<ul>
    {% for tune in tunes %}
    <li>
    <h3><a href="{% url 'tune' tune_id=tune.id %}">{{tune.title_or_mfsession}}</a></h3>
    <div id="notation-{{ id_prefix }}{{ forloop.counter }}"></div>
    <p class="meta">
    {% if tune.rnn_tune %}
    Tune submitted from <a href="{{ tune.rnn_tune.url }}">folkrnn.org</a> {{ tune.submitted|naturalday }}
    {% else %}
    <p class="meta">Original tune submitted {{ tune.submitted|naturalday }}
    {% endif %}
    {% if tune.setting__count > 0 or tune.comment__count > 0 or tune.recording__count > 0 or tune.event__count > 0 %}
    <br>
    {% if tune.setting__count > 0 %}Has {{ tune.setting__count|apnumber }} contributed setting{{ tune.setting__count|pluralize }}. {% endif %}
    {% if tune.comment__count > 0 %}Has been commented upon {{ tune.comment__count|apnumber }} time{{ tune.comment__count|pluralize }}. {% endif %}
    {% if tune.recording__count > 0 %}Has been recorded {{ tune.recording__count|apnumber }} time{{ tune.recording__count|pluralize }}. {% endif %}
    {% if tune.event__count > 0 %}Has been played at {{ tune.event__count|apnumber }} event{{ tune.event__count|pluralize }}. {% endif %}
    {% endif %}
    </p>
    </li>
    {% empty %}
    <li><p>{{ empty_message|default:'No tunes' }}</p></li>
    {% endfor %}
    <script type="text/javascript">
    window.addEventListener("load", function() {
        const params = {
            paddingleft:0,
            paddingright:0,
            responsive: "resize",
        }
        {% for tune in tunes %}
        ABCJS.renderAbc("notation-{{ id_prefix }}{{ forloop.counter }}", "{{ tune.abc_trimmed|escapejs }}", params);
        {% endfor %}
    }, false);
    </script>
</ul>