{% extends "archiver/base.html" %}

{% block title %}{{ profile.get_full_name }}{% endblock %}

{% block content %}
{% load humanize %}
<h1>{{ profile.get_full_name }}</h1>
<div id="tunebook" class="section">
    <div class="section-meta">
    <h2>Tunebook</h2>
    </div>
    <div class="section-body">
        <ul>
            {% for item in tunebook %}
            <li>
            {% if item.tune %}
            <h3><a href="{% url 'tune' tune_id=item.tune.id %}">{{item.tune.title_or_mfsession}}</a></h3>
            <div id="notation-tunebook-{{ forloop.counter }}"></div>
            <p class="meta">Tune added to tunebook {{ item.submitted|naturalday }}</p>
            {% elif item.setting %}{# setting model #}
            <h3><a href="{% url 'tune' tune_id=item.setting.tune.id %}">{{item.setting.title}}</a></h3>
            <div id="notation-tunebook-{{ forloop.counter }}"></div>
            <p class="meta">Setting of <a href="{% url 'tune' tune_id=item.setting.tune.id %}">{{ item.setting.tune.title }}</a> added to tunebook {{ item.submitted|naturalday }}</p>
            {% endif %}
            </li>
            {% empty %}
            {% if user == profile %}
            <li>Your tunebook is empty. To add a tune or setting, go to the tune’s page and you’ll find ‘In your tunebook’ in the sidebar.</li>
            {% else %}
            <li>{{ profile.get_short_name }}’s tunebook is empty.</li>
            {% endif %}
            {% endfor %}
        </ul>
    </div>
    <script type="text/javascript">
    window.addEventListener("load", function() {
        const params = {
            paddingleft:0,
            paddingright:0,
            responsive: "resize",
        }
        {% for item in tunebook %}
        ABCJS.renderAbc("notation-tunebook-{{ forloop.counter }}", {% if item.tune %}"{{ item.tune.abc_trimmed|escapejs }}"{% elif item.setting %}"{{ item.setting.abc_trimmed|escapejs }}"{% endif %}, params);
        {% endfor %}
    }, false);
    </script>
</div>
{% include "archiver/_activity.html" %}
{% endblock %}
