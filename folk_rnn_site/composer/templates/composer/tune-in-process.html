{% extends "composer/base.html" %}

{% block title %}Candidate Tune{% endblock %}
{% block headend %}<!-- <meta http-equiv="refresh" content="1"> -->{% endblock %}

{% block content %}
<div id="tune-in-process">
    <h1 class="content-subhead">Your generated tune</h1>
    <section class="post">
        <h2>Folk RNN Candidate tune no{{ candidate_id }}</h2>
        <p>Composition with prime tokens "{{ prime_tokens }}" {% if rnn_has_started %}in process...{% else %}is waiting for folk_rnn task{% endif %}</p>
    </section>
</div>
<script src="/static/channels/js/websocketbridge.js" type="text/javascript"></script>
<script type="text/javascript">
    // Correctly decide between ws:// and wss://
    const ws_scheme = window.location.protocol == "https:" ? "wss" : "ws";
    const ws_path = ws_scheme + '://' + window.location.host;
    console.log("Connecting to " + ws_path);
    
    const webSocketBridge = new channels.WebSocketBridge();
    webSocketBridge.connect(ws_path);
    webSocketBridge.listen(function(action, stream) {
      console.log(action, stream);
    });
    
    webSocketBridge.socket.addEventListener('open', function() {
        console.log("Connected to WebSocket");
        webSocketBridge.send({prop1: 'value1', prop2: 'value1'});
    })
    
</script>
{% endblock %}
